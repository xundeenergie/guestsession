#! /bin/sh

set -e

# In case this system is running systemd, we make systemd reload the unit files
# to pick up changes.
if [ -d /run/systemd/system ] ; then
	systemctl --system daemon-reload >/dev/null || true
fi
SERVICES="cups-fuse.service"
TARGET="default.target"

case "$1" in

    configure)
        for SERVICE in $SERVICES; do
            [ -e "/etc/systemd/user/${TARGET}.wants/" ] || mkdir -p "/etc/systemd/user/${TARGET}.wants/"
            [ -e "/usr/lib/systemd/user/${SERVICE}" ] && ln -sf "/usr/lib/systemd/user/${SERVICE}" "/etc/systemd/user/${TARGET}.wants/${SERVICE}"
        done

[ -e /etc/systemd/user/default.target.wants/ ] || mkdir -p /etc/systemd/user/default.target.wants/
case "$1" in
    purge)
        for SERVICE in $SERVICES; do
            [ -e "/etc/systemd/user/${SERVICE}" ] || rf -rf "/etc/systemd/user/${SERVICE}"
            [ -e "/etc/systemd/user/${TARGET}.wants/${SERVICE}" ] || rm -rf "/etc/systemd/user/${TARGET}.wants/${SERVICE}"
        done
	#rm -rf /etc/systemd/user/cups-fuse.service
        #rm -rf /etc/systemd/user/default.target.wants/cups-fuse.service
	;;
    abort-upgrade|upgrade)
        ;;
    failed-upgrade|abort-install|disappear)
        ;;
    remove)
        for SERVICE in $SERVICES; do
            [ -e "/etc/systemd/user/${TARGET}.wants/" ] || mkdir -p "/etc/systemd/user/${TARGET}.wants/"
            ln -sf "/dev/null" "/etc/systemd/user/${TARGET}.wants/${SERVICE}"
        done
        #ln -sf /dev/null /etc/systemd/user/default.target.wants/cups-fuse.service
        ;;

    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 0

esac
